<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MochaMagic | Checkout</title>

  <!-- Fonts & Bootstrap -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">
        <span style="color:#d1a679;">Mocha</span>Magic
      </a>
      <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#nav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="nav" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="menu.html">Menu</a></li>
          <li class="nav-item">
            <a class="nav-link" href="cart.html">
              Cart <span class="badge bg-danger cart-badge" style="display:none;">0</span>
            </a>
          </li>
          <li class="nav-item"><a class="nav-link" href="login.html">Login</a></li>
          <li class="nav-item"><a class="nav-link" href="rewards.html">Rewards</a></li>
          <li class="nav-item"><a class="nav-link" href="reviews.html">Reviews</a></li>
          <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Header -->
  <header class="cart-header text-center py-5">
    <h1 class="cart-title">Checkout</h1>
    <p class="cart-subtitle">Complete your order</p>
  </header>

  <!-- Checkout Content -->
  <section class="container my-5">
    <div class="row">
      <!-- Checkout Form -->
      <div class="col-lg-7">
        <div class="card shadow-sm p-4 mb-4">
          <h4 class="mb-4">Delivery Information</h4>
          <form id="checkoutForm">
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">First Name *</label>
                <input type="text" class="form-control" id="firstName" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Last Name *</label>
                <input type="text" class="form-control" id="lastName" required>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Email Address *</label>
              <input type="email" class="form-control" id="email" required>
            </div>

            <div class="mb-3">
              <label class="form-label">Phone Number *</label>
              <input type="tel" class="form-control" id="phone" required>
            </div>

            <div class="mb-3">
              <label class="form-label">Delivery Address *</label>
              <textarea class="form-control" id="address" rows="3" required></textarea>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">City *</label>
                <input type="text" class="form-control" id="city" value="Karachi" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Postal Code</label>
                <input type="text" class="form-control" id="postalCode">
              </div>
            </div>

            <div class="mb-4">
              <label class="form-label">Order Notes (Optional)</label>
              <textarea class="form-control" id="orderNotes" rows="2" placeholder="Any special instructions..."></textarea>
            </div>

            <h4 class="mb-3">Payment Method</h4>
            <div class="form-check mb-2">
              <input class="form-check-input" type="radio" name="payment" id="cod" value="cod" checked>
              <label class="form-check-label" for="cod">
                Cash on Delivery
              </label>
            </div>
            <div class="form-check mb-2">
              <input class="form-check-input" type="radio" name="payment" id="card" value="card">
              <label class="form-check-label" for="card">
                Credit/Debit Card (Coming Soon)
              </label>
            </div>
            <div class="form-check mb-4">
              <input class="form-check-input" type="radio" name="payment" id="easypaisa" value="easypaisa">
              <label class="form-check-label" for="easypaisa">
                Easypaisa/JazzCash (Coming Soon)
              </label>
            </div>
          </form>
        </div>
      </div>

      <!-- Order Summary -->
      <div class="col-lg-5">
        <div class="card shadow-sm p-4 position-sticky" style="top: 100px;">
          <h4 class="mb-4">Order Summary</h4>
          
          <div id="orderItems" class="mb-3">
            <!-- Items will be loaded here -->
          </div>

          <hr>

          <div class="d-flex justify-content-between mb-2">
            <span>Subtotal</span>
            <span id="subtotal">0 PKR</span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Delivery Fee</span>
            <span>150 PKR</span>
          </div>
          <hr>
          <div class="d-flex justify-content-between mb-4">
            <strong>Total</strong>
            <strong id="total" style="color:#d1a679;">0 PKR</strong>
          </div>

          <button type="submit" form="checkoutForm" class="btn btn-primary w-100 mb-2">Place Order</button>
          <a href="cart.html" class="btn btn-outline-secondary w-100">Back to Cart</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer text-center py-4">
    <p>&copy; 2025 <span class="fw-semibold" style="color:#d1a679;">MochaMagic</span>. All rights reserved.</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Check if user is logged in
    function checkLogin() {
      const currentUser = localStorage.getItem('mochamagic_currentUser');
      if (!currentUser) {
        alert('Please login to continue with checkout');
        window.location.href = 'login.html';
        return null;
      }
      return JSON.parse(currentUser);
    }

    // Cart management functions
    const Cart = {
      getItems() {
        const cart = localStorage.getItem('mochamagic_cart');
        return cart ? JSON.parse(cart) : [];
      },

      getTotalCount() {
        const items = this.getItems();
        return items.reduce((total, item) => total + item.quantity, 0);
      },

      getTotalPrice() {
        const items = this.getItems();
        return items.reduce((total, item) => total + (item.price * item.quantity), 0);
      },

      updateCartCount() {
        const count = this.getTotalCount();
        const badges = document.querySelectorAll('.cart-badge');
        badges.forEach(badge => {
          badge.textContent = count;
          badge.style.display = count > 0 ? 'inline' : 'none';
        });
      },

      clear() {
        localStorage.removeItem('mochamagic_cart');
        this.updateCartCount();
      }
    };

    function loadOrderSummary() {
      const items = Cart.getItems();
      const orderItemsDiv = document.getElementById('orderItems');

      // Check if cart is empty
      if (items.length === 0) {
        alert('Your cart is empty!');
        window.location.href = 'menu.html';
        return;
      }

      // Display items
      orderItemsDiv.innerHTML = items.map(item => `
        <div class="d-flex justify-content-between align-items-center mb-2">
          <div>
            <strong>${item.name}</strong>
            <br>
            <small class="text-muted">${item.quantity} Ã— ${item.price} PKR</small>
          </div>
          <span>${item.price * item.quantity} PKR</span>
        </div>
      `).join('');

      // Update totals
      const subtotal = Cart.getTotalPrice();
      const deliveryFee = 150;
      const total = subtotal + deliveryFee;

      document.getElementById('subtotal').textContent = subtotal + ' PKR';
      document.getElementById('total').textContent = total + ' PKR';
    }

    // Handle form submission
    document.getElementById('checkoutForm').addEventListener('submit', function(e) {
      e.preventDefault();

      // Get form data
      const orderData = {
        firstName: document.getElementById('firstName').value,
        lastName: document.getElementById('lastName').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        address: document.getElementById('address').value,
        city: document.getElementById('city').value,
        postalCode: document.getElementById('postalCode').value,
        orderNotes: document.getElementById('orderNotes').value,
        paymentMethod: document.querySelector('input[name="payment"]:checked').value,
        items: Cart.getItems(),
        subtotal: Cart.getTotalPrice(),
        deliveryFee: 150,
        total: Cart.getTotalPrice() + 150,
        orderDate: new Date().toISOString()
      };

      // Store order (for now, just in localStorage - backend will handle this later)
      const orders = JSON.parse(localStorage.getItem('mochamagic_orders') || '[]');
      const orderId = 'ORDER' + Date.now();
      orderData.orderId = orderId;
      orders.push(orderData);
      localStorage.setItem('mochamagic_orders', JSON.stringify(orders));

      // Clear cart
      Cart.clear();

      // Show success message and redirect
      alert(`Order placed successfully!\nOrder ID: ${orderId}\n\nThank you for your order!`);
      window.location.href = 'index.html';
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      // Check login first
      const user = checkLogin();
      if (!user) return;

      // Pre-fill form with user data
      if (user.firstName) document.getElementById('firstName').value = user.firstName;
      if (user.lastName) document.getElementById('lastName').value = user.lastName;
      if (user.email) document.getElementById('email').value = user.email;
      if (user.phone) document.getElementById('phone').value = user.phone || '';
      if (user.address) document.getElementById('address').value = user.address || '';
      if (user.city) document.getElementById('city').value = user.city || 'Karachi';
      if (user.postalCode) document.getElementById('postalCode').value = user.postalCode || '';

      Cart.updateCartCount();
      loadOrderSummary();
    });
  </script>
</body>
</html>